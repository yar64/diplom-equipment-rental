generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ==================== МОДЕЛИ ДЛЯ ДИПЛОМА ====================

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  password      String
  name          String?
  phone         String?
  avatar        String?
  role          UserRole       @default(CUSTOMER)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  // Связи
  favorites     Favorite[]
  bookings      Booking[]
  reviews       Review[]
  staff         Staff?
  notifications Notification[]
  
  @@map("users")
}

model Equipment {
  id              String    @id @default(cuid())
  name            String
  slug            String    @unique
  description     String?
  fullDescription String?   // УДАЛИЛ @db.Text
  pricePerDay     Float
  pricePerWeek    Float?
  pricePerMonth   Float?
  quantity        Int       @default(1)
  available       Boolean   @default(true)
  featured        Boolean   @default(false)
  rating          Float?    @default(0)
  reviewCount     Int       @default(0)
  
  // Изображения - для SQLite храним как JSON строку
  images          String    @default("[]")  // ИЗМЕНИЛ: String[] → String
  mainImage       String?
  
  // Технические характеристики
  powerRequirements String?
  weight           Float?
  dimensions       String?
  brand            String?
  model            String?
  serialNumber     String?   @unique
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Связи
  categoryId      String
  category        Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  bookings        Booking[]
  favorites       Favorite[]
  reviews         Review[]
  
  @@map("equipment")
}

model Category {
  id              String      @id @default(cuid())
  name            String
  slug            String      @unique
  description     String?
  image           String?
  icon            String?
  parentId        String?
  
  // Связи
  parent          Category?   @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: SetNull)
  children        Category[]  @relation("CategoryToCategory")
  equipment       Equipment[]
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@map("categories")
}

model Booking {
  id              String        @id @default(cuid())
  status          BookingStatus @default(PENDING)
  startDate       DateTime
  endDate         DateTime
  totalDays       Int
  totalPrice      Float
  notes           String?
  
  // Информация о мероприятии
  eventType       String?
  eventAddress    String?
  eventDate       DateTime?
  attendeesCount  Int?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Связи
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  equipmentId     String
  equipment       Equipment     @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  
  // Оплата
  paymentId       String?       @unique
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  
  @@map("bookings")
}

model Favorite {
  id          String    @id @default(cuid())
  userId      String
  equipmentId String
  
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  
  @@unique([userId, equipmentId])
  @@map("favorites")
}

model Review {
  id          String    @id @default(cuid())
  rating      Int       @default(5)
  comment     String?   // УДАЛИЛ @db.Text
  isVerified  Boolean   @default(false)
  
  userId      String
  equipmentId String
  
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  equipment   Equipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@unique([userId, equipmentId])
  @@map("reviews")
}

model Staff {
  id          String    @id @default(cuid())
  userId      String    @unique
  position    String
  permissions String    @default("[]")  // ИЗМЕНИЛ: String[] → String
  department  String?
  
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@map("staff")
}

model Notification {
  id          String           @id @default(cuid())
  userId      String
  type        NotificationType
  title       String
  message     String           // УДАЛИЛ @db.Text
  read        Boolean          @default(false)
  link        String?
  
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime         @default(now())
  
  @@map("notifications")
}

model Cart {
  id          String    @id @default(cuid())
  userId      String?
  sessionId   String?
  items       Json      // JSON работает в SQLite
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@map("carts")
}

// ==================== ENUMS ====================

enum UserRole {
  ADMIN
  MANAGER
  STAFF
  CUSTOMER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
  REFUNDED
  PARTIAL
}

enum NotificationType {
  BOOKING_UPDATE
  PAYMENT
  SYSTEM
  PROMOTION
  REMINDER
  MAINTENANCE
}